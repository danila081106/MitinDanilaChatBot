<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ğ§Ğ°Ñ‚-Ğ±Ğ¾Ñ‚ Ğ´Ğ»Ñ Ğ¸Ğ·ÑƒÑ‡ĞµĞ½Ğ¸Ñ Ğ´Ğ¸ĞºĞ¸Ñ… Ğ¶Ğ¸Ğ²Ğ¾Ñ‚Ğ½Ñ‹Ñ… Ğ¸ Ğ¸Ñ… ÑÑ€ĞµĞ´Ñ‹ Ğ¾Ğ±Ğ¸Ñ‚Ğ°Ğ½Ğ¸Ñ</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <link rel="icon" href="C:\Users\danil\Downloads\icon.png" type="image/x-icon">
</head>
<body>
    <div id="chatContainer">
        <!-- Ğ—Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²Ğ¾Ğº Ñ‡Ğ°Ñ‚Ğ° -->
        <div id="chatHeader">
            <img src="{{ url_for('static', filename='icon.png') }}" alt="Ğ›Ğ¾Ğ³Ğ¾Ñ‚Ğ¸Ğ¿ Ñ‡Ğ°Ñ‚-Ğ±Ğ¾Ñ‚Ğ°">
            <span>Ğ§Ğ°Ñ‚-Ğ±Ğ¾Ñ‚ Ğ´Ğ»Ñ Ğ¸Ğ·ÑƒÑ‡ĞµĞ½Ğ¸Ñ Ğ´Ğ¸ĞºĞ¸Ñ… Ğ¶Ğ¸Ğ²Ğ¾Ñ‚Ğ½Ñ‹Ñ… Ğ¸ Ğ¸Ñ… ÑÑ€ĞµĞ´Ñ‹ Ğ¾Ğ±Ğ¸Ñ‚Ğ°Ğ½Ğ¸Ñ</span>
        </div>
        <!-- ĞĞºĞ½Ğ¾ Ñ‡Ğ°Ñ‚Ğ° -->
        <div id="chat"></div>
        <!-- ĞŸĞ°Ğ½ĞµĞ»ÑŒ Ğ²Ğ²Ğ¾Ğ´Ğ° -->
        <div id="inputContainer">
            <input type="text" id="messageInput" placeholder="Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ...">
            <button id="sendButton">ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ</button>
            <button id="emojiToggle">ğŸ˜ƒ</button>
            <!-- ĞšĞ½Ğ¾Ğ¿ĞºĞ° Ğ²Ñ‹Ğ±Ğ¾Ñ€Ğ° Ñ„Ğ°Ğ¹Ğ»Ğ° -->
            <label for="fileInput" class="file-upload-button">ğŸ“</label>
            <input type="file" id="fileInput" accept=".txt" style="display: none;">
        </div>
        <!-- ĞŸĞ°Ğ½ĞµĞ»ÑŒ ÑĞ¼Ğ¾Ğ´Ğ·Ğ¸ -->
        <div id="emojiPanel">
            <div class="emoji-button" onclick="addEmoji('ğŸ˜‚')">ğŸ˜‚</div>
            <div class="emoji-button" onclick="addEmoji('ğŸ¤£')">ğŸ¤£</div>
            <div class="emoji-button" onclick="addEmoji('ğŸ˜Š')">ğŸ˜Š</div>
            <div class="emoji-button" onclick="addEmoji('ğŸ˜')">ğŸ˜</div>
            <div class="emoji-button" onclick="addEmoji('ğŸ‘')">ğŸ‘</div>
            <div class="emoji-button" onclick="addEmoji('ğŸ»')">ğŸ»</div>
            <div class="emoji-button" onclick="addEmoji('ğŸ¦')">ğŸ¦</div>
            <div class="emoji-button" onclick="addEmoji('ğŸ¦“')">ğŸ¦“</div>
            <div class="emoji-button" onclick="addEmoji('ğŸ˜')">ğŸ˜</div>
            <div class="emoji-button" onclick="addEmoji('ğŸ¸')">ğŸ¸</div>
            <div class="emoji-button" onclick="addEmoji('ğŸŒ³')">ğŸŒ³</div>
            <div class="emoji-button" onclick="addEmoji('ğŸŒŠ')">ğŸŒŠ</div>
            <div class="emoji-button" onclick="addEmoji('ğŸŒ')">ğŸŒ</div>
            <div class="emoji-button" onclick="addEmoji('ğŸŒˆ')">ğŸŒˆ</div>
            <div class="emoji-button" onclick="addEmoji('ğŸ“š')">ğŸ“š</div>
            <div class="emoji-button" onclick="addEmoji('ğŸŒ')">ğŸŒ</div>
            <div class="emoji-button" onclick="addEmoji('ğŸ’¡')">ğŸ’¡</div>
        </div>
    </div>
    <script>
        const chat = document.getElementById("chat");
        const messageInput = document.getElementById("messageInput");
        const sendButton = document.getElementById("sendButton");
        const emojiToggle = document.getElementById("emojiToggle");
        const emojiPanel = document.getElementById("emojiPanel");

        // Ğ­Ğ»ĞµĞ¼ĞµĞ½Ñ‚Ñ‹
        const fileInput = document.getElementById("fileInput");

        // ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ²Ñ‹Ğ±Ğ¾Ñ€Ğ° Ñ„Ğ°Ğ¹Ğ»Ğ°
        fileInput.addEventListener("change", function (event) {
            const file = event.target.files[0]; // ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ñ„Ğ°Ğ¹Ğ»

            if (file) {
                // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, ÑĞ²Ğ»ÑĞµÑ‚ÑÑ Ğ»Ğ¸ Ñ„Ğ°Ğ¹Ğ» Ñ‚ĞµĞºÑÑ‚Ğ¾Ğ²Ñ‹Ğ¼
                if (file.type === "text/plain" || file.name.endsWith(".txt")) {
                    // Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ğ¾Ğ±ÑŠĞµĞºÑ‚ FileReader Ğ´Ğ»Ñ Ñ‡Ñ‚ĞµĞ½Ğ¸Ñ Ñ„Ğ°Ğ¹Ğ»Ğ°
                    const reader = new FileReader();

                    reader.onload = function (e) {
                        const fileContent = e.target.result; // Ğ¡Ğ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ğ¾Ğµ Ñ„Ğ°Ğ¹Ğ»Ğ°
                        appendMessage("You", `Ğ’Ñ‹ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ğ»Ğ¸ Ñ„Ğ°Ğ¹Ğ»:\n${file.name}\n\nĞ¡Ğ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ğ¾Ğµ:\n${fileContent}`, "user");

                        // ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµĞ¼ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ğ¾Ğµ Ñ„Ğ°Ğ¹Ğ»Ğ° Ğ½Ğ° ÑĞµÑ€Ğ²ĞµÑ€ (ĞµÑĞ»Ğ¸ Ğ½ÑƒĞ¶Ğ½Ğ¾)
                        sendMessageWithFile(fileContent);
                    };

                    reader.readAsText(file); // Ğ§Ğ¸Ñ‚Ğ°ĞµĞ¼ Ñ„Ğ°Ğ¹Ğ» ĞºĞ°Ğº Ñ‚ĞµĞºÑÑ‚
                } else {
                    alert("ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ²Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ñ‚ĞµĞºÑÑ‚Ğ¾Ğ²Ñ‹Ğ¹ Ñ„Ğ°Ğ¹Ğ» (.txt).");
                }
            }
        });

        // Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ Ñ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ñ‹Ğ¼ Ñ„Ğ°Ğ¹Ğ»Ğ°
        function sendMessageWithFile(fileContent) {
            fetch("/api/chat", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ message: fileContent })
            })
                .then(response => response.json())
                .then(data => {
                    appendMessage("Ollama", data.response, "system");
                })
                .catch(error => {
                    console.error("Error:", error);
                    appendMessage("Error", "Could not get response.", "system");
                });
        }



        // ĞŸĞµÑ€ĞµĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸ ÑĞ¼Ğ¾Ğ´Ğ·Ğ¸
        emojiToggle.addEventListener("click", function () {
            emojiPanel.classList.toggle("active");
            emojiToggle.classList.toggle("active");
        });

        // Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑĞ¼Ğ¾Ğ´Ğ·Ğ¸ Ğ² Ğ¿Ğ¾Ğ»Ğµ Ğ²Ğ²Ğ¾Ğ´Ğ°
        function addEmoji(emoji) {
            const userInput = document.getElementById("messageInput");
            userInput.value += emoji; // Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ½Ñ‹Ğ¹ ÑĞ¼Ğ¾Ğ´Ğ·Ğ¸ Ğ² Ğ¿Ğ¾Ğ»Ğµ Ğ²Ğ²Ğ¾Ğ´Ğ°
            userInput.focus();
        }

        // Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚Ğ¸Ğµ Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸ ÑĞ¼Ğ¾Ğ´Ğ·Ğ¸ Ğ¿Ñ€Ğ¸ ĞºĞ»Ğ¸ĞºĞµ Ğ²Ğ½Ğµ Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸
        document.addEventListener('click', function (event) {
            if (!emojiPanel.contains(event.target) && event.target.id !== "emojiToggle") {
                emojiPanel.classList.remove("active");
                emojiToggle.classList.remove("active");
            }
        });

        // ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ
        messageInput.addEventListener("keydown", function (event) {
            if (event.key === "Enter") {
                sendMessage();
            }
        });

        function addEmoji(emoji) {
            const userInput = document.getElementById("messageInput");
            userInput.value += emoji; // Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ½Ñ‹Ğ¹ ÑĞ¼Ğ¾Ğ´Ğ·Ğ¸ Ğ² Ğ¿Ğ¾Ğ»Ğµ Ğ²Ğ²Ğ¾Ğ´Ğ°
            userInput.focus(); // ĞŸĞµÑ€ĞµĞ²Ğ¾Ğ´Ğ¸Ğ¼ Ñ„Ğ¾ĞºÑƒÑ Ğ¾Ğ±Ñ€Ğ°Ñ‚Ğ½Ğ¾ Ğ½Ğ° Ğ¿Ğ¾Ğ»Ğµ Ğ²Ğ²Ğ¾Ğ´Ğ°

            // ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ĞºĞ½Ğ¾Ğ¿ĞºÑƒ, ĞºĞ¾Ñ‚Ğ¾Ñ€Ğ°Ñ Ğ±Ñ‹Ğ»Ğ° Ğ½Ğ°Ğ¶Ğ°Ñ‚Ğ°
            const button = event.target;

            // Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ ĞºĞ»Ğ°ÑÑ "confirmed" Ğ´Ğ»Ñ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ° Ğ°Ğ½Ğ¸Ğ¼Ğ°Ñ†Ğ¸Ğ¸
            button.classList.add("confirmed");

            // Ğ£Ğ´Ğ°Ğ»ÑĞµĞ¼ ĞºĞ»Ğ°ÑÑ Ñ‡ĞµÑ€ĞµĞ· 0.5 ÑĞµĞºÑƒĞ½Ğ´Ñ‹ (Ğ²Ñ€ĞµĞ¼Ñ Ğ°Ğ½Ğ¸Ğ¼Ğ°Ñ†Ğ¸Ğ¸)
            setTimeout(() => {
                button.classList.remove("confirmed");
            }, 500);

            // Ğ¡ĞºÑ€Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ ÑĞ¼Ğ¾Ğ´Ğ·Ğ¸
            const emojiPanel = document.getElementById("emojiPanel");
            const emojiToggle = document.getElementById("emojiToggle");

            // Ğ£Ğ±Ğ¸Ñ€Ğ°ĞµĞ¼ ĞºĞ»Ğ°ÑÑ "active" Ñƒ Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸ Ğ¸ ĞºĞ½Ğ¾Ğ¿ĞºĞ¸
            emojiPanel.classList.remove("active");
            emojiToggle.classList.remove("active");
        }

        function sendMessage() {
            const message = messageInput.value.trim();
            if (message) {
                appendMessage("You", message, "user");
                messageInput.value = "";
                fetch("/api/chat", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({ message: message })
                })
                    .then(response => response.json())
                    .then(data => {
                        appendMessage("Ollama", data.response, "system");
                    })
                    .catch(error => {
                        console.error("Error:", error);
                        appendMessage("Error", "Could not get response.", "system");
                    });
            }
        }

        // Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ Ğ² Ñ‡Ğ°Ñ‚
        function appendMessage(sender, text, type) {
            const messageElement = document.createElement("div");
            messageElement.className = `message ${type}`;
            messageElement.innerHTML = `<strong>${sender}:</strong> ${text}<span class="timestamp">${new Date().toLocaleTimeString()}</span>`;
            chat.appendChild(messageElement);
            chat.scrollTop = chat.scrollHeight;
        }
    </script>
</body>
</html>